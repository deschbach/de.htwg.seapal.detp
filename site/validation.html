<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script type="text/javascript">

        function editNodeText(regex, input, helpId, helpMessage) {        // See if the visitor entered the right information

            if (!regex.test(input)) {          // If the wrong information was entered, warn them
                if (helpId != null)

                    while (helpId.firstChild) // Remove any warnings that may exist
                        helpId.removeChild(helpId.firstChild);

                var knoten = document.createElement();
                knoten.innerHTML = helpMessage;
                helpId.appendChild(knoten); // Add new warning
                return false;
            }

            else {          // If the right information was entered, clear the help message
                if (helpId != null) {
                    while (helpId.firstChild) // Remove any warnings that may exist
                        helpId.removeChild(helpId.firstChild);
                }
                return true;
            }
        }

        function formatCoordinateFromMap(val, type) {

            var value = val.toString();

            if (/e.*/.test(value)) {
                value = "0";
            }

            value = value.replace(/\./, '\u00B0');

            value = value.replace(/[°].*/, function (s) {
                s = s.replace(/[°]/, '0.');
                s = parseFloat(s) * 60;
                s = s.toString();
                if (s.indexOf('.') == -1)
                    s += ".";
                while (s.length < 5)
                    s += "0";
                for (var j = s.indexOf('.'); j < 2; j++)
                    s = '0' + s;
                return '\u00B0' + s.substr(0, 5);
            });

            if (!/[°]/.test(value)) {
                value = value + "\u00B000.00";
            }

            value = value.replace(/.*[°]/, function (s) {
                var negative = false;
                if (s.substr(0, 1) == '-') {
                    s = s.substring(1);
                    negative = true;
                }
                var j = 3;
                if (type == "long")
                    j++;

                for (var i = 0; s.length < j; i++)
                    s = "0" + s;
                if (negative)
                    s = "-" + s;

                return s;
            });

            if (type == "lat") {
                if (value.substr(0, 1) == "-") {
                    value = value.substr(1);
                    value = value + "\u2032S";
                } else {
                    value = value + "\u2032N";
                }
                value = "Lat " + value;
            } else { // type == "long"
                if (value.substr(0, 1) == "-") {
                    value = value.substr(1);
                    value = value + "\u2032W";
                } else {
                    value = value + "\u2032E";
                }
                value = "Long " + value;
            }

            return value;
        }

        function isCoordinateOk(inputField, helpId) {        // See if the input value contains any text

            var inputValue = inputField.value.replace(/[\u0027]/g, '').replace(/[\u2032]/g, '').replace(/[\u2018]/g, '').replace(/[ ]/g, '')
                .replace(/[NESW]/g, '\u2032$& ');

            inputValue = inputValue.replace(/( \d{1,3}\D)|(^\d{1,2}\D)/g, function (s) {
                return s.replace(/[°]/, '').replace(/\./, '').replace(/\d{1,3}/, '$&\u00B0');
            });

            inputValue = inputValue.replace(/[°]\d{0,2}\.?\d{0,2}[\u2032]/g, function (s) {
                s = s.replace(/[°]/, '').replace(/[\u2032]/, '');

                var i = s.indexOf('.');
                if (i == -1) {
                    while (s.length < 4)
                        s += '0';
                } else {
                    s = s.replace(/\./, '');
                    for (var j = i; j < 2; j++)
                        s = '0' + s;
                    while (s.length < 4)
                        s += '0';
                }

                return '\u00B0' + s.substr(0, 2) + '.' + s.substr(2, 2) + '\u2032';
            });

            var count = 0;
            inputValue = inputValue.replace(/\d+[°]/g, function (s) {
                var digits = count + 3;

                if (count == 0)
                    count++;

                while (s.length < digits)
                    s = '0' + s;

                return s;
            });

            document.getElementById('result').innerHTML = inputValue;
            return editNodeText(/^[0-9]{1,2}[°]\d\d\.\d\d[\u2032][NS] [0-9]{1,3}[°]\d\d\.\d\d[\u2032][WE] $/, inputValue, helpId,
                'Enter a Coordinate like 47&deg;49.89&prime;N 009&deg;00.50&prime;E');
        }

    </script>
</head>
<body>
    <form action="post">
    <div align="center">
        <label for="coordinate">
            Koordinate eingeben:</label>
        <input id="coordinate" name="coordinate" type="text" size="30" onblur="isCoordinateOk(this, document.getElementById('coordinate_help'))" />
        <span id="coordinate_help"></span>
        <br />
        <input type="reset" value="reset" />
        <br />
        <span id="result"></span>
    </div>
    </form>
</body>
</html>
